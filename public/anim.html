<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>植物</title>
  <style>
    #tutorial {
      border: 1px solid black;
      /* background-color: rgba(0, 0,0, .2); */
    }

    #ddiv,
    #amindis {
      width: 800px;
      height: 100px;
    }

    #ddiv div,
    #amindis div {
      float: left;
    }

    .cloiu {
      width: 150px;
      height: 80px;
      font-size: 25px;
      margin-left: 30px;
      background-color: rgb(0, 110, 255);
      border-radius: 5px;
      text-align: center;
      line-height: 80px;
      cursor: pointer;
      color: #fff;
      margin-bottom: 10px;
    }

    #ddiv div {
      background-color: #0696ff;
    }

    #amindis div {
      background-color: #be95ff;
    }


    #ddiv div:hover {
      background-color: #dabdba;
    }

    #ddiv div:focus {
      background-color: red;
      border: none;
    }

    #amindis div:hover {
      background-color: #9f1853;
    }

    #amindis div:focus {
      background-color: #667798;
    }
    
  </style>
</head>

<body>
    <div id="ddiv">
      <div tabindex="1" class="cloiu">植物形状1</div>
      <div tabindex="2" class="cloiu">植物形状2</div>
      <div tabindex="3" class="cloiu">植物形状3</div>
      <div tabindex="4" class="cloiu">植物形状4</div>
    </div>
    <div id="amindis">
      <div tabindex="1" class="cloiu">显示动画1</div>
      <div tabindex="2" class="cloiu">显示动画2</div>
      <div tabindex="3" class="cloiu">显示动画3</div>
      <div tabindex="4" class="cloiu">显示动画4</div>
    </div>

    <!-- width="800" height="800" -->
    <canvas id="tutorial">
      不支持
    </canvas>


  <script>
    var canvas = document.getElementById('tutorial');
    let width = 800,
      height = 800,
      h = 400,
      w = 400;

    canvas.width = width;
    canvas.height = height;
    var ctx = canvas.getContext('2d');
    let tcys = "Gray" //背景色
    let xtys = "LawnGreen" //线条颜色


    var ball = {
      x: 100,
      y: 100,
      radius: 25,
      color: 'blue',
      draw: function () {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
        ctx.closePath();
        ctx.fillStyle = this.color;
        ctx.fill();
      }
    };



    // ctx.fillStyle = tcys ;
    // ctx.fillRect(0, 0, width, height);

    let csarr = []

    let bginmar = ["F", "F", "X", "X"]
    let roultar = [{
      F: "F[+F]F[-F][F]" //20
    }, {
      F: "FF-[-F+F+F]+[+F-F-F]" //22.5
    }, {
      X: "F[+X]F[-X]+X",
      F: "FF"
    }, {
      X: "F-[[X]+X]+F[+FX]-X", //22.5 X
      F: "FF"
    }]
    let jiushidu = (Math.PI / 180) * 90 //初始角度，这个转化为弧度，为了后面统一。
    let xxyy = [0, -300, jiushidu];
    let qeqe = [];
    let quanjuid = 0;

    let colotysr = "1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"

    let tree = {
      initArr: function (nm, bginm, roult) {
        let sstr = bginm;
        for (var i = 0; i < nm; i++) {
          let arr = sstr.split("");
          let ddfaar = arr.map((a) => {
            if (a == "F") {
              return roult.F
            }
            if (a == "X") {
              return roult.X
            } else {
              return a
            }
          })
          sstr = ddfaar.join("")
        }
        return sstr; //字符串
      },
      the: 5
    }


    let arrD = tree.initArr(7, "X", {
      X: "F[+X][-X]FX",
      F: "FF"
    })
    let arrDL = arrD.length;
    let anrm

    // function animDraw(deg, lengt, strAr, arlth) {
       function draw(deg, lengt, strAr, arlth) {
        ctx.clearRect(0, 0, width, height)
        ctx.fillStyle = tcys;
        ctx.fillRect(0, 0, width, height);
        //获取所有数据的字符串
        let sstr = strAr.slice(0, tree.the);
        qeqe = []
        xxyy = [0, -300, jiushidu];
        drawInit(deg, lengt, sstr);
        if (tree.the < arlth) {
          tree.the += 5;
          anrm = requestAnimationFrame(function(){
            draw(deg, lengt, strAr, arlth)
          })
        } else {
          cancelAnimationFrame(anrm);
          qeqe = []
          xxyy = [0, -300, jiushidu];
          ctx.clearRect(0, 0, width, height)
          ctx.fillStyle = tcys;
          ctx.fillRect(0, 0, width, height);
          drawInit(deg, lengt, strAr);
        }
      }
    // }


    draw(25.7, 2, arrD, arrDL)

    function drawInit(ddeg, cdcf, sstr) {
      let linchan = cdcf;
      ctx.lineWidth = 1;
      ctx.strokeStyle = xtys;
      ctx.beginPath();
      let llth = sstr.length;
      ctx.moveTo(zbzuabh(xxyy[0], xxyy[1])[0], zbzuabh(xxyy[0], xxyy[1])[1]);
      // console.log(zbzuabh(xxyy[0], xxyy[1])[0], zbzuabh(xxyy[0], xxyy[1])[1])
      for (let i = 0; i < llth; i++) {
        try {
          onedw(ctx, sstr[i], ddeg, linchan)
        } catch (error) {
          console.log("错误")
        }
      }
      ctx.stroke()
    }


    function ddid(nm, bginm, roult, ddeg, cdcf) {
      ctx.fillStyle = tcys;
      ctx.fillRect(0, 0, width, height);
      //获取所有数据的字符串
      let sstr = tree.initArr(nm, bginm, roult);

      let linchan = cdcf
      ctx.lineWidth = 1;
      ctx.strokeStyle = xtys;
      ctx.beginPath()
      let llth = sstr.length;
      let corot = 0;
      ctx.moveTo(zbzuabh(xxyy[0], xxyy[1])[0], zbzuabh(xxyy[0], xxyy[1])[1]);
      for (let i = 0; i < llth; i++) {
        try {
          onedw(ctx, sstr[i], ddeg, linchan)
        } catch (error) {

        }
      }
      ctx.stroke()

    }

    function onedw(ctx, str, ddeg, xc_linchan) {
      let linchan = xc_linchan
      switch (str) {
        case "F":
          xxyy = dddzb(xxyy, 0, linchan);
          let xzz = zbzuabh(xxyy[0], xxyy[1])
          ctx.lineTo(xzz[0], xzz[1])
          break;
        case "[":
          qeqe.push(xxyy)
          break;
        case "]":
          if (qeqe.length > 0) {
            let dyg = qeqe.pop();
            ctx.moveTo(zbzuabh(dyg[0], dyg[1])[0], zbzuabh(dyg[0], dyg[1])[1]);
            xxyy = dyg
          }
          break;
        case "+":
          xxyy = dddzb(xxyy, ddeg, linchan, true);
          break;
        case "-":
          xxyy = dddzb(xxyy, -ddeg, linchan, true);
          break;
        default:
          break;
      }
    }

    //算出下一点坐标
    function dddzb(znar, deg, r, zgjd = false) {
      //角度转化
      let jdhhd = (Math.PI / 180) * deg
      let xx = znar[0]
      let yy = znar[1]
      let qq = znar[2]
      let xzjd = jdhhd + qq
      let xyxzxx = xx + Math.cos(xzjd) * r;
      let xyxzyy = yy + Math.sin(xzjd) * r;
      csarr.push([deg, Math.ceil(qq * 180 / (Math.PI)), Math.ceil(xzjd * 180 / (Math.PI))])
      return zgjd ? [xx, yy, xzjd] : [xyxzxx, xyxzyy, xzjd]
    }


    function zbzuabh(a, b) {
      return [w + a, h - b]
    }

    // let ddiv = document.getElementById("ddiv");
    // ddiv.addEventListener("click", (e) => {
    //   cancelAnimationFrame(anrm);
    //   let etr = e.target;
    //   let sxz = etr.getAttribute("tabindex")
    //   let numm = parseInt(sxz) - 1

    //   let degggf = [
    //     [5, 20],
    //     [4, 22.5],
    //     [8, 20],
    //     [7, 22.5]
    //   ]
    //   let linchan = [10, 10, 1, 2]
    //   // bginmar
    //   ctx.clearRect(0, 0, width, height)
    //   tree.the = 5
    //   xxyy = [0, -300, jiushidu];
    //   qeqe = [];
    //   quanjuid = numm + 1;
    //   let adm = tree.initArr(degggf[numm][0], bginmar[numm], roultar[numm])
    //   let admDL = adm.length;
    //   animDraw(degggf[numm][1], linchan[numm], adm, admDL)()
    // })



    function doubl(e, callback) {
      cancelAnimationFrame(anrm);
      let etr = e.target;
      let sxz = etr.getAttribute("tabindex")
      let numm = parseInt(sxz) - 1

      let degggf = [
        [5, 20],
        [4, 22.5],
        [8, 20],
        [7, 22.5]
      ]
      let linchan = [10, 10, 1, 2]
      // bginmar
      ctx.clearRect(0, 0, width, height)
      tree.the = 5
      xxyy = [0, -300, jiushidu];
      qeqe = [];
      quanjuid = numm + 1;
      //执行回调
      // callback() ;
      callback(degggf[numm][0], bginmar[numm], roultar[numm], degggf[numm][1], linchan[numm])
    }

    let ddiv = document.getElementById("ddiv");
    ddiv.addEventListener("click", (e) => {
      doubl(e, function (a, b, c, d, f) {
        ddid(a, b, c, d, f)
      })
    })

    let amindis = document.getElementById("amindis");
    amindis.addEventListener("click", (e) => {
      doubl(e, function (a, b, c, d, f) {
        let adm = tree.initArr(a, b, c)
        let admDL = adm.length;
        draw(d, f, adm, admDL)
      })
    })




    // ddid(7, "X", {
    //   X: "F[+X][-X]FX",
    //   F: "FF"
    // }, 25.7, 2)
  </script>
</body>

</html>